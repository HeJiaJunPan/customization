" Startup {{{
filetype indent plugin on


" vim æ–‡ä»¶æŠ˜å æ–¹å¼ä¸º marker
" æ–‡ä»¶æŠ˜å æ˜¾ç¤ºåˆ‡æ¢å¿«æ·é”®ä¸ºza
augroup ft_vim
    au!

    autocmd FileType vim setlocal foldmethod=marker

    " æ‰“å¼€æ–‡ä»¶æ€»æ˜¯å®šä½åˆ°ä¸Šæ¬¡ç¼–è¾‘çš„ä½ç½®
    autocmd BufReadPost *
      \ if line("'\"") > 1 && line("'\"") <= line("$") |
      \   exe "normal! g`\"" |
      \ endif

    augroup END
augroup END
" }}}


" General {{{
"set pythonthreedll=python36.dll
"ç¦æ­¢ç”Ÿæˆä¸´æ—¶æ–‡ä»¶
set nobackup
set noswapfile

"å†å²è®°å½•æ•°
set history=1024

"1ä¸æ˜¾ç¤ºä¹¦ç­¾æ 
set showtabline=1

"è®¾ç½®å½“æ–‡ä»¶åœ¨å¤–éƒ¨è¢«ä¿®æ”¹ï¼Œè‡ªåŠ¨æ›´æ–°è¯¥æ–‡ä»¶
set autoread

set autochdir
"set whichwrap=b,s,<,>,[,]
set nobomb

"ä½¿å›æ ¼é”®ï¼ˆbackspaceï¼‰æ­£å¸¸å¤„ç†indent, eol, startç­‰
set backspace=indent,eol,start whichwrap+=<,>,[,]

" Vim çš„é»˜è®¤å¯„å­˜å™¨å’Œç³»ç»Ÿå‰ªè´´æ¿å…±äº«
set clipboard+=unnamed

" è®¾ç½® alt é”®ä¸æ˜ å°„åˆ°èœå•æ 
set winaltkeys=no


" }}}


" Lang & Encoding {{{
"æŸ¥è¯¢å½“å‰ç¼–è¾‘çš„æ–‡ä»¶çš„å­—ç¬¦ç¼–ç æ–¹å¼å¹¶æ‰“å¼€
set fileencodings=utf-8,gbk2312,gbk,gb18030,cp936

"vimå†…éƒ¨ä½¿ç”¨çš„å­—ç¬¦ç¼–ç æ–¹å¼
set encoding=utf-8
set langmenu=zh_CN.UTF-8
let $LANG = 'en_US.UTF-8'
"vimæç¤ºä¿¡æ¯ä¹±ç çš„è§£å†³
"language messages zh_CN.UTF-8
"å·¥ä½œçš„ç»ˆç«¯æˆ–è€…Windowsçš„Consoleçª—å£çš„å­—ç¬¦ç¼–ç æ–¹å¼
"set termencoding=utf-8

"vimçš„èœå•ä¹±ç è§£å†³
source $VIMRUNTIME/delmenu.vim
source $VIMRUNTIME/menu.vim
" }}}


" GUI {{{
colorscheme molokai
"colorscheme github
"let g:molokai_original = 1

set cursorline
set hlsearch
set number
" çª—å£å¤§å°
set lines=32 columns=120
" åˆ†å‰²å‡ºæ¥çš„çª—å£ä½äºå½“å‰çª—å£ä¸‹è¾¹/å³è¾¹
set splitbelow
set splitright
"ä¸æ˜¾ç¤ºå·¥å…·/èœå•æ 
set guioptions-=T " éšè—å·¥å…·æ 
set guioptions-=m " éšè—èœå•æ 
"set guioptions-=L
"set guioptions-=r
"set guioptions-=b
" ä½¿ç”¨å†…ç½® tab æ ·å¼è€Œä¸æ˜¯ gui
set guioptions-=e
set nolist

" set listchars=tab:â–¶\ ,eol:Â¬,trail:Â·,extends:>,precedes:<
set guifont=Consolas:h12:cANSI
" }}}


" Keymap {{{
"é…ç½®å‰ç¼€é”®
let mapleader=","
nnoremap \ ,
nnoremap J j
nnoremap K k
inoremap jk <ESC>
nnoremap <Up> <Nop>
nnoremap <Down> <Nop>
nnoremap <Left> <Nop>
nnoremap <Right> <Nop>
nnoremap // :nohlsearch<CR>
inoremap {} {<CR>}<ESC>O
"é‡è½½é…ç½®æ–‡ä»¶
nnoremap <leader>sv :source $MYVIMRC<cr>
"æ‰“å¼€é…ç½®æ–‡ä»¶
nnoremap <leader>ev :vs $MYVIMRC<cr>

nnoremap <leader>tn :tabnew<cr>
nnoremap <leader>tc :tabclose<cr>
nnoremap <leader>th :tabp<cr>
nnoremap <leader>tl :tabn<cr>

" å½“å‰æ–‡ä»¶çˆ¶ç›®å½•
"cnoremap <expr> %% getcmdtype( ) == ':' ? expand('%:h').'/' : '%%'

" ç§»åŠ¨åˆ†å‰²çª—å£
nnoremap <C-j> <C-W>j
nnoremap <C-k> <C-W>k
nnoremap <C-h> <C-W>h
nnoremap <C-l> <C-W>l

" æ­£å¸¸æ¨¡å¼ä¸‹ alt+j,k,h,l è°ƒæ•´åˆ†å‰²çª—å£å¤§å°
"nnoremap <M-j> :resize +5<cr>
"nnoremap <M-k> :resize -5<cr>
"nnoremap <M-h> :vertical resize -5<cr>
"nnoremap <M-l> :vertical resize +5<cr>

" æ‰“å¼€å½“å‰ç›®å½• windows
nnoremap <silent> <leader>ex :!start explorer %:p:h<CR>

" æ‰“å¼€å½“å‰ç›®å½•CMD
nnoremap <silent> <leader>cmd :!start cmd /k cd %:p:h<cr>
" æ‰“å°å½“å‰æ—¶é—´
nnoremap <F3> a<C-R>=strftime("%Y-%m-%d %a %I:%M %p")<CR><Esc>

" å¤åˆ¶å½“å‰æ–‡ä»¶/è·¯å¾„åˆ°å‰ªè´´æ¿
nnoremap ,fn :let @*=substitute(expand("%"), "/", "\\", "g")<CR>
nnoremap ,fp :let @*=substitute(expand("%:p"), "/", "\\", "g")<CR>

" }}}


" Plugin {{{
set nocompatible
filetype off  
set rtp+=$VIM/bundle/Vundle.vim  
"vundle ç®¡ç†çš„æ’ä»¶åˆ—è¡¨å¿…é¡»ä½äº vundle#begin() å’Œ vundle#end() ä¹‹é—´  
call vundle#begin('$VIM/bundle')  
Plugin 'VundleVim/Vundle.vim'  
Plugin 'Lokaltog/vim-powerline' "status ç¾åŒ–  
Plugin 'scrooloose/nerdcommenter' "å¤šè¡Œæ³¨é‡Šï¼Œleaderé”®+ccç”Ÿæˆ, leader+cuåˆ é™¤æ³¨é‡Š
Plugin 'kien/ctrlp.vim' "æœç´¢å†å²æ‰“å¼€æ–‡ä»¶ï¼Œåœ¨å‘½ä»¤è¡Œæ¨¡å¼ä¸‹æŒ‰ctrl+pè§¦å‘  
Plugin 'vim-scripts/grep.vim' "åœ¨å‘½ä»¤è¡Œæ¨¡å¼ä½¿ç”¨grepå‘½ä»¤ï¼Œ:Grep

"-------------------------------------NERDTree Start--------------------------------------------
Plugin 'scrooloose/nerdtree' "æ–‡ä»¶æµè§ˆ
"NERDTreeçª—å£åˆ‡æ¢å¿«æ·é”®
nnoremap <leader>l :NERDTreeToggle<CR>
" æ˜¾ç¤ºè¡Œå·
let NERDTreeShowLineNumbers=1
let NERDTreeAutoCenter=1
" æ˜¯å¦æ˜¾ç¤ºéšè—æ–‡ä»¶
let NERDTreeShowHidden=1
" è®¾ç½®å®½åº¦
let NERDTreeWinSize=24
" åœ¨ç»ˆç«¯å¯åŠ¨vimæ—¶ï¼Œå…±äº«NERDTree
let g:nerdtree_tabs_open_on_console_startup=1
" å¿½ç•¥ä¸€ä¸‹æ–‡ä»¶çš„æ˜¾ç¤º
let NERDTreeIgnore=['\.idea', '\.vscode', 'node_modules','\.pyc','\~$','\.swp','\.swp']
" æ˜¾ç¤ºä¹¦ç­¾åˆ—è¡¨
"let NERDTreeShowBookmarks=1
"-------------------------------------NERDTree END----------------------------------------------

"-----------------------------------Markdown Start----------------------------------------------
Plugin 'godlygeek/tabular'
Plugin 'plasticboy/vim-markdown'
let g:vim_markdown_folding_disabled = 1
"-----------------------------------Markdown End------------------------------------------------

"Plugin 'nathanaelkane/vim-indent-guides.git' "ç¼©è¿›å¯¹é½æ˜¾ç¤º
"Plugin 'octol/vim-cpp-enhanced-highlight' "å¯¹c++è¯­æ³•é«˜äº®å¢å¼º  
"Plugin 'kshenoy/vim-signature' "ä¹¦ç­¾å¯è§†åŒ–çš„æ’ä»¶  
"Plugin 'vim-scripts/BOOKMARKS--Mark-and-Highlight-Full-Lines' "ä¹¦ç­¾è¡Œé«˜äº®  
"Plugin 'majutsushi/tagbar' "taglistçš„å¢å¼ºç‰ˆï¼ŒæŸ¥çœ‹æ ‡ç­¾ï¼Œä¾èµ–äºctags
"Plugin 'Lokaltog/vim-easymotion' "å¿«é€Ÿè·³è½¬ï¼ŒæŒ‰ä¸¤ä¸‹leaderé”®å’Œfç»„åˆ  
"Plugin 'vim-scripts/ShowTrailingWhitespace.git' "é«˜äº®æ˜¾ç¤ºè¡Œå°¾çš„å¤šä½™ç©ºç™½å­—ç¬¦  
"Plugin 'vim-scripts/indentpython.vim.git'  
"Plugin 'vim-scripts/Solarized.git' "ä¸»é¢˜æ–¹æ¡ˆ
"Plugin 'Valloric/YouCompleteMe' "è‡ªåŠ¨è¡¥å…¨
"Plugin 'vim-scripts/indexer.tar.gz' "è‡ªåŠ¨ç”Ÿæˆæ ‡ç­¾  
"Plugin 'vim-scripts/DfrankUtil' "indexer ä¾èµ–  
"Plugin 'vim-scripts/vimprj' "indexer ä¾èµ–  
"Plugin 'davidhalter/jedi-vim' "python è¡¥å…¨ï¼Œä¸ä¾èµ–äºtags,ä½†æ¯”è¾ƒæ…¢ï¼Œå¯ä»¥ä½¿ç”¨indexeræ›¿æ¢ï¼Œä½†ä¸èƒ½è·³è½¬é¡¹ç›®å¤–  
"Plugin 'vim-scripts/Markdown'  
"Plugin 'tpope/vim-surround'  
"Plugin 'ekalinin/Dockerfile.vim'
"Plugin 'w0rp/ale'
"Plugin 'python-mode/python-mode'
"let g:pymode_python = 'python3'
"Plugin 'davidhalter/jedi-vim'
"let g:jedi#completions_command = "<C-N>"
"Plugin 'vim-syntastic/syntastic'
" æ’ä»¶åˆ—è¡¨ç»“æŸ
call vundle#end()  
filetype on  
" }}}


" ä»£ç é£æ ¼ {{{
"é€šç”¨è®¾ç½®
set ruler
set showmode
syntax on

set autoindent
set shiftwidth=4
set tabstop=4
set softtabstop=4
set expandtab

"TABç¼©è¿›
"autocmd FileType c,cpp,python set shiftwidth=4
"autocmd FileType c,cpp,python set tabstop=4

"autocmd FileType javascript,html,xml,css,java set shiftwidth=2
"autocmd FileType javascript,html,xml,css,java set tabstop=2

"python TAB to Blank
"autocmd FileType python,javascript set expandtab
"autocmd FileType python,javascript set softtabstop=4

"è‡ªåŠ¨ç¼©è¿›
"autocmd FileType c,cpp set cindent
"autocmd FileType python set autoindent
"autocmd FileType javascript,html,xml,css,java set autoindent

"ä»£ç è¿è¡Œ
autocmd FileType java nnoremap <F5> :!start cmd /k cd %:p:h && javac -encoding UTF-8 % && java %:r && pause && exit<CR>
autocmd FileType python nnoremap <F5> :!start cmd /k cd %:p:h && python % && pause && exit<CR>

" }}}
    " PyMode {{{
        if isdirectory(expand("~/.vim/plugged/python-mode"))
            " python version
            if has('python3')
                let g:pymode_python = 'python3'
            else
                let g:pymode_python = 'python'
            endif
            " disable pymode_rope and pymode_folding for slow problem
            let g:pymode_rope = 0
            let g:pymode_folding = 0
            let g:pymode_trim_whitespaces = 1
            let g:pymode_options = 0
            " doc for python
            let g:pymode_doc = 0
            " motion
            let g:pymode_motion = 1
            " run python
            let g:pymode_run_bind = '<leader>R'
            " breakpoint
            let g:pymode_breakpoint = 1
            let g:pymode_breakpoint_bind = '<LocalLeader>p'
            let g:pymode_breakpoint_cmd = 'import pdb;pdb.set_trace()'
            " pymode check disable
            if count(g:spf13_bundle_groups, 'syntax')
                let g:pymode_lint = 0
            else
                let g:pymode_lint = 1
                nmap <F9> :PymodeLint<CR>
                let g:pymode_lint_signs = 1
                " no check when white
                let g:pymode_lint_on_write = 0
                " check when save
                let g:pymode_lint_unmodified = 0
                " not check of fly
                let g:pymode_lint_on_fly = 0
                " show message of error line
                let g:pymode_lint_message = 1
                " checkers
                let g:pymode_lint_checkers = ['pyflakes','pep8']
                "let g:pymode_lint_checkers = ['pep8']
                let g:pymode_lint_ignore = "E128,E2,E3,E501"
                " not Auto open cwindow (quickfix) if any errors have been found
                let g:pymode_lint_cwindow = 0
            endif
            if isdirectory(expand("~/.vim/plugged/python-syntax"))
                let g:pymode_syntax = 0
                let g:pymode_syntax_all = 0
            else
                let g:pymode_syntax = 1
                let g:pymode_syntax_all = 1
            endif
        endif
    " }}}
    
" å»¶æ—¶å¯åŠ¨å‡½æ•° {{{
    " 200
    function! Defer_ale(timer) abort
      call plug#load('ale')
    endfunction

    " 250
    "function! Defer_airline(timer) abort
      "call plug#load('vim-airline')
      "call plug#load('vim-airline-themes')
      "redraws!
    "endfunction

    " 300
    "function! Defer_gitgutter(timer) abort
      "call plug#load('vim-gitgutter')
      "silent! GitGutterEnable
    "endfunction

    " 400
    "function! Defer_programming(timer) abort
      "call plug#load('rainbow')
      "call plug#load('vim-rooter')
      "call plug#load('vim-polyglot')
    "endfunction

    " 500
    "function! Defer_defaults(timer) abort
      "if has('patch-8.0.1206') || has('nvim-0.2.3')
        "call plug#load('traces.vim')
      "endif
      "call plug#load('vim_current_word')
      "call plug#load('vim-signature')
      "call plug#load('vim-rsi')
    "endfunction

    " 600
    function! Defer_motion(timer) abort
      "call plug#load('vim-sneak')
      call plug#load('vim-easymotion')
      "call plug#load('incsearch-easymotion.vim')
    endfunction

    " 700
    "function! Defer_fzf(timer) abort
      "call plug#load('fzf')
      "call plug#load('fzf.vim')
    "endfunction

    " 800
    function! Defer_fugitive(timer) abort
      call plug#load('vim-fugitive')
    endfunction

    " 1000
    "function! Defer_ycm(timer) abort
      "call plug#load('YouCompleteMe')
    "endfunction

    "function! Defer_markdown(timer) abort
      "call plug#load('vim-markdown')
    "endfunction

    "function! Defer_rust(timer) abort
      "call plug#load('rust.vim')
    "endfunction

    "function! Defer_go(timer) abort
       "call plug#load('vim-go')
    "endfunction

    "function! Defer_python(timer) abort
      "call plug#load('python-mode')
      "call plug#load('SimpylFold')
    "endfunction
" }}}


    Plug 'vim-airline/vim-airline'
    Plug 'vim-airline/vim-airline-themes'

    " vim-airline {{{
        if isdirectory(expand("~/.vim/plugged/vim-airline-themes"))
            let g:airline_theme="bubblegum"
            let g:airline_powerline_fonts = 0
            let g:airline_symbols_ascii = 1
            let g:airline_exclude_preview = 0
            let g:airline_highlighting_cache = 1
            let g:airline#extensions#whitespace#enabled = 0
            " tabåºå·
            let g:airline#extensions#tabline#tab_nr_type = 1
            let g:airline#extensions#tabline#enabled = 0
            " disable buffers on topright
            "let g:airline#extensions#tabline#tabs_label = ''
            "let g:airline#extensions#tabline#show_splits = 0
            "let g:airline#extensions#tabline#show_close_button = 0
            "let g:airline#extensions#tabline#buffer_nr_show = 0
            "let g:airline#extensions#bufferline#enabled = 1
            " shw full_path of the file,and the time
            let g:airline_section_c = "\ %F\ \ %{strftime(\"%Y/%m/%d\ %H:%M\")}"
	        if !exists('g:airline_symbols')
                let g:airline_symbols = {}
            endif
            let g:airline_symbols.crypt = 'ğŸ”’'
            let g:airline_symbols.linenr = 'â˜°'
            let g:airline_symbols.maxlinenr = ''
            let g:airline_symbols.branch = 'â‡'
            let g:airline_symbols.paste = 'Ï'
            let g:airline_symbols.notexists = 'âˆ„'
            let g:airline_symbols.whitespace = 'Î'
            "let g:airline_left_sep = 'â–¶'
            let g:airline_left_alt_sep = 'â¯'
            "let g:airline_right_sep = 'â—€'
            let g:airline_right_alt_sep = 'â®'
        elseif has('statusline')
            if isdirectory(expand("~/.vim/plugged/vim-fugitive"))
                set statusline=\ %{fugitive#statusline()}
            else
                set statusline=%<
            endif
            set statusline+=\ %F\ \ %{strftime(\"%Y/%m/%d\ %H:%M\")}
            if isdirectory(expand("~/.vim/plugged/ale"))
                set statusline+=\ %{ALEGetStatusLine()}
            endif
            "set statusline+=\ [%{&ff}/%Y]
	        set statusline+=%=%25([%{&ff}/%Y]\ %p%%\ \ %l/%L:\ %c%)\ %<
		endif
    " }}}